zabbix_export:
  version: '6.0'
  date: '2023-10-11T22:47:29Z'
  groups:
    - uuid: 57b7ae836ca64446ba2c296389c009b7
      name: Templates/Modules
  templates:
    - uuid: 13e80ba4873d4863813b82005daa7c30
      template: 'Zypper updateinfo by Zabbix trapper'
      name: 'Zypper updateinfo by Zabbix trapper'
      description: |
        Retrieve information about available updates and security fixes on SUSE or derivatives using zypper.
        
        Requires zypper-updateinfo.py script to be run periodically on host to send the item data to Zabbix.
        
        Created by Robin Roevens (robin.roevens (at) disroot.org)
      groups:
        - name: Templates/Modules
      items:
        - uuid: 065de023b78c42388fd8a8e16237d5be
          name: 'Packages: List of available updates'
          type: DEPENDENT
          key: zypper.updateinfo.packages
          delay: '0'
          history: 7d
          trends: '0'
          value_type: TEXT
          description: 'List of package updates available and not yet installed.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.packages.list
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          master_item:
            key: zypper.updateinfo.raw
          tags:
            - tag: component
              value: packages
        - uuid: 83b43425b74649808fef138f95aa2f14
          name: 'Packages: # of available updates'
          type: DEPENDENT
          key: 'zypper.updateinfo.packages[all]'
          delay: '0'
          history: 7d
          description: 'Number of available and not yet installed updates in all enabled repositories'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.packages.all
          master_item:
            key: zypper.updateinfo.raw
          tags:
            - tag: component
              value: packages
          triggers:
            - uuid: b1d403c327fc4e2e9be06449563957f0
              expression: 'nodata(/Zypper updateinfo by Zabbix trapper/zypper.updateinfo.packages[all],{$ZYPPER.UPDATEINFO.MAXAGE})=1'
              name: 'Zypper: No new update information received for {$ZYPPER.UPDATEINFO.MAXAGE}'
              priority: WARNING
              description: 'zypper-updateinfo.py script did not run or failed to run within {$ZYPPER_UPDATEINFO_MAXAGE}. Check if the script is working correctly and if a Systemd timer or cronjob is set up for it to run at expected intervals.'
              tags:
                - tag: scope
                  value: availability
        - uuid: 2f7f5dcc3ce2433cadbfd887ed0a7423
          name: 'Zypper updateinfo'
          type: TRAP
          key: zypper.updateinfo.raw
          delay: '0'
          history: '0'
          trends: '0'
          value_type: TEXT
          description: 'Raw package and patch updates info as generated by the zypper-updateinfo.py script'
          tags:
            - tag: component
              value: raw
        - uuid: 843ed31200e5468abcd07032d6127814
          name: 'Patches: Known vulnerabilities'
          type: DEPENDENT
          key: zypper.updateinfo.security.cves
          delay: '0'
          history: 7d
          trends: '0'
          value_type: TEXT
          description: 'The system or some software on the system is vulnerable to these known vulnerabilities. Check http://cve.mitre.org for detailed information about each vulnerability.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.patches.security.cves
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          master_item:
            key: zypper.updateinfo.raw
          tags:
            - tag: component
              value: patches
      discovery_rules:
        - uuid: 14f9a7ea26534d8e8e6707e778d3832c
          name: 'Patch category/severity discovery'
          type: TRAP
          key: zypper.updateinfo.patch_category.discovery
          delay: '0'
          filter:
            conditions:
              - macro: '{#CATEGORY}'
                value: '{$ZYPPER.PATCH.CATEGORY_FILTER}'
                formulaid: A
              - macro: '{#SEVERITY}'
                value: '{$ZYPPER.PATCH.SEVERITY_FILTER}'
                formulaid: B
          lifetime: '0'
          item_prototypes:
            - uuid: 50efaad3a09f427b8b66e9ed974dfedf
              name: 'Patches: {#CATEGORY}: {#SEVERITY} available'
              type: DEPENDENT
              key: 'zypper.updateinfo.patches[{#CATEGORY},{#SEVERITY}]'
              delay: '0'
              history: 7d
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.patches.{#CATEGORY}.{#SEVERITY}'
              master_item:
                key: zypper.updateinfo.raw
              tags:
                - tag: category
                  value: '{#CATEGORY}'
                - tag: component
                  value: patches
              trigger_prototypes:
                - uuid: e379b6a37b8b48a3bf4a5ea8cca38679
                  expression: 'last(/Zypper updateinfo by Zabbix trapper/zypper.updateinfo.patches[{#CATEGORY},{#SEVERITY}])<>0'
                  name: 'Zypper: New {#SEVERITY} {#CATEGORY} patches are available'
                  description: 'One or more {#CATEGORY} patches with {#SEVERITY} severity are available for the system.'
                  tags:
                    - tag: scope
                      value: security
          overrides:
            - name: 'Adapt trigger severity to High'
              step: '1'
              filter:
                conditions:
                  - macro: '{#CATEGORY}'
                    value: ^(security|recommended)$
                    formulaid: A
                  - macro: '{#SEVERITY}'
                    value: ^(critical|high)$
                    formulaid: B
              operations:
                - operationobject: TRIGGER_PROTOTYPE
                  operator: REGEXP
                  value: 'New .* patches are available'
                  severity: HIGH
            - name: 'Adapt trigger severity to Average'
              step: '2'
              filter:
                conditions:
                  - macro: '{#CATEGORY}'
                    value: ^(security|recommended)
                    formulaid: A
                  - macro: '{#SEVERITY}'
                    value: important
                    formulaid: B
              operations:
                - operationobject: TRIGGER_PROTOTYPE
                  operator: REGEXP
                  value: 'New .* patches are available'
                  severity: AVERAGE
            - name: 'Adapt trigger severity to Warning'
              step: '3'
              filter:
                evaltype: FORMULA
                formula: '(A and B) or (C and D)'
                conditions:
                  - macro: '{#CATEGORY}'
                    value: ^(security|recommended)$
                    formulaid: A
                  - macro: '{#SEVERITY}'
                    value: moderate
                    formulaid: B
                  - macro: '{#CATEGORY}'
                    value: ^(optional|feature|document|yast)$
                    formulaid: C
                  - macro: '{#SEVERITY}'
                    value: ^(critical|important)$
                    formulaid: D
              operations:
                - operationobject: TRIGGER_PROTOTYPE
                  operator: REGEXP
                  value: 'New .* patches are available'
                  severity: WARNING
            - name: 'Adapt trigger severity to Information'
              step: '4'
              filter:
                evaltype: FORMULA
                formula: '(A and B) or (C and D)'
                conditions:
                  - macro: '{#CATEGORY}'
                    value: ^(security|recommended)$
                    formulaid: A
                  - macro: '{#SEVERITY}'
                    value: low
                    formulaid: B
                  - macro: '{#CATEGORY}'
                    value: ^(optional|feature|document|yast)$
                    formulaid: C
                  - macro: '{#SEVERITY}'
                    value: ^(moderate|low)$
                    formulaid: D
              operations:
                - operationobject: TRIGGER_PROTOTYPE
                  operator: REGEXP
                  value: 'New .* patches are available'
                  severity: INFO
            - name: 'Add tag scope:security to category security'
              step: '5'
              filter:
                conditions:
                  - macro: '{#CATEGORY}'
                    value: security
                    formulaid: A
              operations:
                - operationobject: TRIGGER_PROTOTYPE
                  operator: REGEXP
                  value: 'New .* patches are available'
                  tags:
                    - tag: scope
                      value: security
            - name: 'Add tags scope:performance and scope:availability to category recommended'
              step: '6'
              filter:
                conditions:
                  - macro: '{#CATEGORY}'
                    value: recommended
                    formulaid: A
              operations:
                - operationobject: TRIGGER_PROTOTYPE
                  operator: REGEXP
                  value: 'New .* patches are available'
                  tags:
                    - tag: scope
                      value: availability
                    - tag: scope
                      value: performance
            - name: 'Add tag scope:notice to category optional/feature/document/yast'
              step: '7'
              filter:
                conditions:
                  - macro: '{#CATEGORY}'
                    value: ^(optional|feature|document|yast)$
                    formulaid: A
              operations:
                - operationobject: TRIGGER_PROTOTYPE
                  operator: REGEXP
                  value: 'New .* patches are available'
                  tags:
                    - tag: scope
                      value: notice
        - uuid: eaae8c00683c4193b6acc6cee0eb0c9a
          name: 'Package update repositories discovery'
          type: TRAP
          key: zypper.updateinfo.repositories.discovery
          delay: '0'
          filter:
            conditions:
              - macro: '{#ALIAS}'
                value: '{$ZYPPER.REPO.ALIAS_FILTER}'
                formulaid: A
              - macro: '{#AUTOREFRESH}'
                value: '{$ZYPPER.REPO.AUTOREFRESH_FILTER}'
                formulaid: B
              - macro: '{#ENABLED}'
                value: '{$ZYPPER.REPO.ENABLED_FILTER}'
                formulaid: C
          lifetime: '0'
          item_prototypes:
            - uuid: 154227e4aae64df2b3b34bf01793789f
              name: 'Available package updates in {#NAME}'
              type: DEPENDENT
              key: 'zypper.updateinfo.packages[{#ALIAS}]'
              delay: '0'
              history: 7d
              description: 'Number of package updates currently available in repository {#NAME} ({#ALIAS})'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.packages.["{#ALIAS}"]'
              master_item:
                key: zypper.updateinfo.raw
              tags:
                - tag: component
                  value: packages
      tags:
        - tag: class
          value: software
        - tag: target
          value: 'package manager'
        - tag: target
          value: zypper
      macros:
        - macro: '{$ZYPPER.PATCH.CATEGORY_FILTER}'
          value: ^(security|recommended|optional|feature|document|yast)$
          description: 'Patch categories to monitor for new patches'
        - macro: '{$ZYPPER.PATCH.SEVERITY_FILTER}'
          value: ^(critical|important|moderate|low|unspecified)$
          description: 'Patch severities to monitor for new patches'
        - macro: '{$ZYPPER.REPO.ALIAS_FILTER}'
          value: '^(.*)$'
          description: 'Filter on alias of repositories to discover'
        - macro: '{$ZYPPER.REPO.AUTOREFRESH_FILTER}'
          value: ^(0|1)$
          description: 'Filter on ''autorefresh'' attribute of repositories to discover'
        - macro: '{$ZYPPER.REPO.ENABLED_FILTER}'
          value: '1'
          description: 'Filter on ''enabled'' attribute of repositories to discover'
        - macro: '{$ZYPPER.UPDATEINFO.MAXAGE}'
          value: 2d
          description: 'Max age of available security updates information'
  triggers:
    - uuid: d9f760bce4374747a5849d9af66e7398
      expression: 'last(/Zypper updateinfo by Zabbix trapper/zypper.updateinfo.packages[all])>0 and length(last(/Zypper updateinfo by Zabbix trapper/zypper.updateinfo.packages))>0'
      name: 'Zypper: New package updates are available'
      opdata: '{ITEM.VALUE1}'
      priority: INFO
      description: |
        One or more package updates are available for the system.
        Following packages can be updated:
        {ITEM.VALUE2}
      tags:
        - tag: scope
          value: notice
